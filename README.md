# geekbang

第二周

我们在数据库操作的时候，比如 dao 层中当遇到一个 sql.ErrNoRows 的时候，是否应该 Wrap 这个 error，抛给上层。为什么，应该怎么做请写出代码？



## 分析

wrap抛给上层的缺点：

- 没有 生成错误的file：line信息
- 没有导致错误的调用堆栈跟踪

造成定位error难度大，起码要听很多很多首一首凉凉的时间，才能定位，以至于日常开发中会有诸多不便利。



错误处理原则

- 错误要被日志记录，日志应该包含失败的答案
- 应用程序处理错误，保证100%完整性，
- 之后不再报告当前错误



关于Wrap是否抛给上层的问题

答：抛给上层，前提是需要保存原始的堆栈信息，

业务逻辑使用errors.news或者errors.Errorf保存堆栈信息

调用第三方库errors.wrap或errors.wrapf保存堆栈信息，能处理错误，不影响逻辑主干可以不用抛

目前抛给上层需要借助第三方库github.com/pkg/errors或者使用1.13版本内置的方法











